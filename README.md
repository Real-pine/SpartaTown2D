# 박참솔의 SpartaTown만들기

## 🏁프로젝트 소개

내일배움캠프 두 번째 개인과제 프로젝트!
TopDown뷰잉 2D게임 개인 제작 프로젝트입니다.

## 🛠구현기능

> __필수 기능__

✅캐릭터만들기

✅캐릭터 이동

✅방 만들기

✅카메라 따라가기

✅캐릭터 애니메이션 추가

✅이름 입력 시스템

✅캐릭터 선택 시스템

> __도전 기능__

✅시간 표시 

✅인게임 이름 바꾸기

✅참석인원UI

✅인게임 캐릭터 선택

✅NPC 대화

## ⛓와이어 프레임

![와이어 프레임](https://i.ibb.co/q0CTnS0/image.jpg)


## 트러블 슈팅 기록
 - 보이지 않는 벽에 막혀서 캐릭터가 움직이지 않는 문제
   - 타일 콜라이더를 잘못 설정했나 싶어 다시 재설정 시도 -> 실패
   - 알고보니 캐릭터를 프리팹으로 설정하는 과정에서 캐릭터들의 콜라이더의 transform이 이상하게 튄 바람에
     다시 재설정 함으로 문제 해결✔
     
 - 애니메이션이 기존 스프라이트 이미지 위에 덧 그려지는 문제
    - 시험 플레이시 플레이뷰나 씬뷰에서나 캐릭터 스프라이트가 그대로 있는 와중에 그 위에 애니메이션이 더해지면서 이미지가 겹치는 문제가 발생
    - SpriteRenderer는 MainSprite라는 자식오브젝트 컴퍼넌트에 할당해놨고, 부모오브젝트에게 Animator 컴퍼넌트를 할당시켜 문제가 발생했다고 의심함
    - animator역시 자식오브젝트에게 컴퍼넌트를 할당해줬지만 문제는 여전했음
    - 다시 보니 부모 오브젝트에도 SpriteRenderer가 할당 되어있고, 자식 오브젝트에도 SpriteRenderer가 할당 되어 있어서 생긴 문제였음.
      부모 오브젝트의 SpriteRenderer를 제거해주며 문제 해결✔
      
  - MainCamera Follow기능 문제
    - 카메라와 캐릭터의 Transform값은 디버그상 제대로 변화하는데 씬뷰에서나 게임뷰에서나 캐릭터와 카메라는 전혀 움직이지 않음
      - 진짜 거의 모든 코드에 다 디버그를 해봤을 정도로 코드 하나하나 다 디버깅을 해도 디버깅상에서는 문제가 없는데 플레이 시에는 문제가 발생
      - 5시간 정도를 끙끙대며 고민하다 한숨 자고왔는데 컴퓨터를 다시 켜보니 문제가 해결되어 있었음
      - 문제를 도중에 해결한 것 같은데 어떻게 해결한 지를 알 수 없음..😡

  - 게임 씬 매니저와 인게임 UI매니저의 충돌
    - GameSceneManager와 GameUIManager 둘 다 싱글톤으로 구현을 해서 충돌이 발생.
    - 왜 내가 싱글톤을 두 개나 만들었나 생각해보니, GameSceneManager는 StartScene에서 MainScene으로 넘어오는 과정에서 데이터 유지를 위해 그냥
      편하게 개발하려고 대충 싱글톤으로 만들어서 데이터를 전달해주는 역할을 떠넘김. (다시 생각해보면 ScriptObject로 데이터를 관리하기 때문에 굳이 싱글톤을 만들 이유도 없었음)
    - 맡은 역할은 GameUIManager가 더 많지만, 맡은 중요도 자체는 GameSceneManager가 더 큰 상황.
    - 그래서 GameUIManager를 GameSceneManager에 병합시키고, 싱글톤을 하나로 유지하는 것으로 이어나감✔

  - MainScene에서 캐릭터 변경, 이름 변경을 시도하면 캐릭터의 position이 초기화 되는 문제
    - 캐릭터 변경 기능과 이름 변경을 하면 CharacterSpawn메서드를 호출하게 되는데 이 과정은 캐릭터의 데이터만 남기고 프리팹자체를 삭제했다가 다시 새로 생성하는 방식임
    - ScriptObject에 캐릭터의 position을 저장하기로 결정하고, CharacterSpawn메서드 로직에 스폰할때마다 저장된 캐릭터 위치를 불러오는 방식으로 해결✔

  - 메인 씬에서 이름 변경 버튼을 눌러도 패널이 팝업되지 않는 문제
    - 리스너를 쓸 때마다 초기화시키고, 쓰기 전에도 초기화 시키는 등 철저하게 관리를 한 것 같은데 문제가 발생
    - 플레이하면서 인스펙터 창을 보면서 뭐가 문젠지 봤는데 싱글톤으로 기능하는 GameSceneManager에 참조가 제대로 되지 않는 상황을 인지
      ![싱글톤이문제다](https://i.ibb.co/ZBmZmgV/1.png)
    - 문제가 된 상황은 StartScene과 MainScene에서 참조하는 오브젝트들이 다르기 때문에 씬전환이 이뤄지면서 GameSceneManager가 혼란을 겪으며 발생한 것
    - GameSceneManager에서 GameObject.Find()로 동적으로 오브젝트들을 할당해줬지만 NameInputPanel은 비활성화된 오브젝트라서 참조가 여전히 안됨
    - FindInactivObject()로 다시 동적할당을 시도했고 문제 해결✔ -> 하지만 싱글톤을 쓴 과거의 자신에게 다시 분노😡
   
  - 인게임 이름 변경이 제대로 되지 않는 문제
    - ScriptableObject에서 playerName은 실시간으로 변경이 되는데, 게임뷰 UI를 보면 캐릭터의 이름이 바뀌지 않음
    - 다시 생각해보면 캐릭터 선택은 즉각 피드백이 반영되서 CharacterSpawn메서드가 실행되게끔 로직을 구성했는데 이름은 업데이트되도 이걸 감지하고 CharacterSpawn을 호출하지 않음
    - 먼저 playerName 업데이트를 바로 인지하게끔 하고, CharacterSpawn메서드의 로직을 업데이트를 감지하고나서 스폰하는 것으로 변경함으로 문제 해결✔
   

## 📄 기술 스택

- Language
  - C#
- 게임 엔진
  - Unity - 2022.3.17f1
- IDE
  - VisualStudio2022
